"use strict";(()=>{var e={};e.id=688,e.ids=[688],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1212:e=>{e.exports=require("async_hooks")},8893:e=>{e.exports=require("buffer")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},629:e=>{e.exports=require("fs/promises")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},1764:e=>{e.exports=require("util")},1096:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>k,patchFetch:()=>q,requestAsyncStorage:()=>x,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var o={};t.r(o),t.d(o,{GET:()=>g});var s=t(9303),a=t(8716),n=t(670),i=t(7070),u=t(3538),c=t(5456);let l=process.env.GOOGLE_CLIENT_ID||"",p=process.env.GOOGLE_CLIENT_SECRET||"",d=process.env.GOOGLE_REDIRECT_URI||"http://localhost:3000/api/auth/google/callback";async function g(e){let{searchParams:r}=new URL(e.url),t=r.get("code"),o=r.get("state");if(!l||!p)return i.NextResponse.json({error:"Google OAuth not configured"},{status:500});if(!t)return i.NextResponse.json({error:"Missing code"},{status:400});try{let e=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:t,client_id:l,client_secret:p,redirect_uri:d,grant_type:"authorization_code"})}),r=await e.json();if(!e.ok||!r.access_token)return console.error("google token error",r),i.NextResponse.json({error:"Failed to exchange token"},{status:500});let s=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${r.access_token}`}}),a=await s.json();if(!s.ok||!a.email)return console.error("google userinfo error",a),i.NextResponse.json({error:"Failed to fetch user info"},{status:500});let n=a.email,g=a.id,h=a.name,x=await u._.user.upsert({where:{email:n},update:{googleId:g},create:{email:n,passwordHash:null,role:"user",googleId:g,profile:{create:{nickname:h||n,role:"user",nicknameUpdatedAt:null}}},include:{profile:!0}}),m=(0,c.B3)({userId:x.id,role:x.role});return(0,c.Uj)(m),i.NextResponse.redirect(o||"/",{status:302})}catch(e){return console.error("google callback error",e),i.NextResponse.json({error:"OAuth failed"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/google/callback/route",pathname:"/api/auth/google/callback",filename:"route",bundlePath:"app/api/auth/google/callback/route"},resolvedPagePath:"C:\\Users\\user\\Documents\\coding\\userhythm\\backend\\src\\app\\api\\auth\\google\\callback\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:x,staticGenerationAsyncStorage:m,serverHooks:f}=h,k="/api/auth/google/callback/route";function q(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},5456:(e,r,t)=>{t.d(r,{B3:()=>u,Rf:()=>l,Uj:()=>c,v6:()=>p});var o=t(1482),s=t.n(o),a=t(1615);let n="ur_session",i=process.env.SESSION_SECRET||"dev-secret-change-me",u=e=>s().sign(e,i,{expiresIn:604800}),c=e=>{(0,a.cookies)().set(n,e,{httpOnly:!0,sameSite:"strict",secure:!0,path:"/",maxAge:604800})},l=()=>{(0,a.cookies)().set(n,"",{httpOnly:!0,sameSite:"strict",secure:!0,path:"/",maxAge:0})},p=e=>{let r=e.cookies.get(n)?.value;if(!r)return null;try{return s().verify(r,i)}catch{return null}}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[276,972,261,538],()=>t(1096));module.exports=o})();