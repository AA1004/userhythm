"use strict";(()=>{var e={};e.id=688,e.ids=[688],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},2761:e=>{e.exports=require("node:async_hooks")},2254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},5673:e=>{e.exports=require("node:events")},7561:e=>{e.exports=require("node:fs")},612:e=>{e.exports=require("node:os")},9411:e=>{e.exports=require("node:path")},9117:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>u,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var s=r(9303),a=r(8716),n=r(670),i=r(9038),c=e([i]);i=(c.then?(await c)():c)[0];let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/google/callback/route",pathname:"/api/auth/google/callback",filename:"route",bundlePath:"app/api/auth/google/callback/route"},resolvedPagePath:"C:\\Users\\user\\Documents\\coding\\userhythm\\backend\\src\\app\\api\\auth\\google\\callback\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:h}=l,g="/api/auth/google/callback/route";function u(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}o()}catch(e){o(e)}})},9038:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{GET:()=>c});var s=r(7070),a=r(3538),n=r(5456),i=e([a]);a=(i.then?(await i)():i)[0];let u=process.env.GOOGLE_CLIENT_ID||"",l=process.env.GOOGLE_CLIENT_SECRET||"",p=process.env.GOOGLE_REDIRECT_URI||"http://localhost:3000/api/auth/google/callback";async function c(e){let{searchParams:t}=new URL(e.url),r=t.get("code"),o=t.get("state");if(!u||!l)return s.NextResponse.json({error:"Google OAuth not configured"},{status:500});if(!r)return s.NextResponse.json({error:"Missing code"},{status:400});try{let e=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:r,client_id:u,client_secret:l,redirect_uri:p,grant_type:"authorization_code"})}),t=await e.json();if(!e.ok||!t.access_token)return console.error("google token error",t),s.NextResponse.json({error:"Failed to exchange token"},{status:500});let i=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),c=await i.json();if(!i.ok||!c.email)return console.error("google userinfo error",c),s.NextResponse.json({error:"Failed to fetch user info"},{status:500});let d=c.email,h=c.id,g=c.name,x=await a._.user.upsert({where:{email:d},update:{googleId:h},create:{email:d,passwordHash:null,role:"user",googleId:h,profile:{create:{nickname:g||d,role:"user",nicknameUpdatedAt:null}}},include:{profile:!0}}),m=(0,n.B3)({userId:x.id,role:x.role});return(0,n.Uj)(m),s.NextResponse.redirect(o||"/",{status:302})}catch(e){return console.error("google callback error",e),s.NextResponse.json({error:"OAuth failed"},{status:500})}}o()}catch(e){o(e)}})},5456:(e,t,r)=>{r.d(t,{B3:()=>c,Rf:()=>l,Uj:()=>u,v6:()=>p});var o=r(1482),s=r.n(o),a=r(1615);let n="ur_session",i=process.env.SESSION_SECRET||"dev-secret-change-me",c=e=>s().sign(e,i,{expiresIn:604800}),u=e=>{(0,a.cookies)().set(n,e,{httpOnly:!0,sameSite:"strict",secure:!0,path:"/",maxAge:604800})},l=()=>{(0,a.cookies)().set(n,"",{httpOnly:!0,sameSite:"strict",secure:!0,path:"/",maxAge:0})},p=e=>{let t=e.cookies.get(n)?.value;if(!t)return null;try{return s().verify(t,i)}catch{return null}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972,901,261,538],()=>r(9117));module.exports=o})();