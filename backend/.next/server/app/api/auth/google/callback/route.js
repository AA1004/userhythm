"use strict";(()=>{var e={};e.id=688,e.ids=[688],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},1096:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{GET:()=>g});var s=r(9303),a=r(8716),n=r(670),i=r(7070),c=r(728),u=r(5456);let l=process.env.GOOGLE_CLIENT_ID||"",p=process.env.GOOGLE_CLIENT_SECRET||"",d=process.env.GOOGLE_REDIRECT_URI||"http://localhost:3000/api/auth/google/callback";async function g(e){let{searchParams:t}=new URL(e.url),r=t.get("code"),o=t.get("state");if(!l||!p)return i.NextResponse.json({error:"Google OAuth not configured"},{status:500});if(!r)return i.NextResponse.json({error:"Missing code"},{status:400});try{let e=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:r,client_id:l,client_secret:p,redirect_uri:d,grant_type:"authorization_code"})}),t=await e.json();if(!e.ok||!t.access_token)return console.error("google token error",t),i.NextResponse.json({error:"Failed to exchange token"},{status:500});let s=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}}),a=await s.json();if(!s.ok||!a.email)return console.error("google userinfo error",a),i.NextResponse.json({error:"Failed to fetch user info"},{status:500});let n=a.email,g=a.id,h=a.name,m=await c._.user.upsert({where:{email:n},update:{googleId:g},create:{email:n,passwordHash:null,role:"user",googleId:g,profile:{create:{nickname:h||n,role:"user",nicknameUpdatedAt:null}}},include:{profile:!0}}),x=(0,u.B3)({userId:m.id,role:m.role});return(0,u.Uj)(x),i.NextResponse.redirect(o||"/",{status:302})}catch(e){return console.error("google callback error",e),i.NextResponse.json({error:"OAuth failed"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/google/callback/route",pathname:"/api/auth/google/callback",filename:"route",bundlePath:"app/api/auth/google/callback/route"},resolvedPagePath:"C:\\Users\\user\\Documents\\coding\\userhythm\\backend\\src\\app\\api\\auth\\google\\callback\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:f}=h,k="/api/auth/google/callback/route";function v(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},5456:(e,t,r)=>{r.d(t,{B3:()=>c,Rf:()=>l,Uj:()=>u,v6:()=>p});var o=r(1482),s=r.n(o),a=r(1615);let n="ur_session",i=process.env.SESSION_SECRET||"dev-secret-change-me",c=e=>s().sign(e,i,{expiresIn:604800}),u=e=>{(0,a.cookies)().set(n,e,{httpOnly:!0,sameSite:"strict",secure:!0,path:"/",maxAge:604800})},l=()=>{(0,a.cookies)().set(n,"",{httpOnly:!0,sameSite:"strict",secure:!0,path:"/",maxAge:0})},p=e=>{let t=e.cookies.get(n)?.value;if(!t)return null;try{return s().verify(t,i)}catch{return null}}},728:(e,t,r)=>{r.d(t,{_:()=>s});let o=require("@prisma/client"),s=global.prisma||new o.PrismaClient({})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972,261],()=>r(1096));module.exports=o})();