"use strict";(()=>{var e={};e.id=303,e.ids=[303],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},2761:e=>{e.exports=require("node:async_hooks")},2254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},5673:e=>{e.exports=require("node:events")},7561:e=>{e.exports=require("node:fs")},612:e=>{e.exports=require("node:os")},9411:e=>{e.exports=require("node:path")},8062:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>l});var n=r(9303),a=r(8716),o=r(670),i=r(1499),p=e([i]);i=(p.then?(await p)():p)[0];let c=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/profile/display-name/route",pathname:"/api/profile/display-name",filename:"route",bundlePath:"app/api/profile/display-name/route"},resolvedPagePath:"C:\\Users\\user\\Documents\\coding\\userhythm\\backend\\src\\app\\api\\profile\\display-name\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:x}=c,m="/api/profile/display-name/route";function u(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:l})}s()}catch(e){s(e)}})},1499:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{POST:()=>p});var n=r(7070),a=r(3538),o=r(5456),i=e([a]);async function p(e){try{let t=(0,o.v6)(e);if(!t)return n.NextResponse.json({error:"unauthorized"},{status:401});let{displayName:r}=await e.json();if(!r||"string"!=typeof r)return n.NextResponse.json({error:"displayName is required"},{status:400});let s=await a._.profile.findUnique({where:{userId:t.userId}});if(!s)return n.NextResponse.json({error:"profile not found"},{status:404});if(s.nicknameUpdatedAt){let e=new Date(s.nicknameUpdatedAt.getTime()+6048e5);if(new Date<e)return n.NextResponse.json({success:!1,nextChangeAt:e},{status:200})}return await a._.profile.update({where:{userId:t.userId},data:{nickname:r,nicknameUpdatedAt:new Date,updatedAt:new Date}}),n.NextResponse.json({success:!0})}catch(e){return console.error("display-name error",e),n.NextResponse.json({error:"failed to update display name"},{status:500})}}a=(i.then?(await i)():i)[0],s()}catch(e){s(e)}})},5456:(e,t,r)=>{r.d(t,{B3:()=>p,Rf:()=>c,Uj:()=>u,v6:()=>d});var s=r(1482),n=r.n(s),a=r(1615);let o="ur_session",i=process.env.SESSION_SECRET||"dev-secret-change-me",p=e=>n().sign(e,i,{expiresIn:604800}),u=e=>{(0,a.cookies)().set(o,e,{httpOnly:!0,sameSite:"strict",secure:!0,path:"/",maxAge:604800})},c=()=>{(0,a.cookies)().set(o,"",{httpOnly:!0,sameSite:"strict",secure:!0,path:"/",maxAge:0})},d=e=>{let t=e.cookies.get(o)?.value;if(!t)return null;try{return n().verify(t,i)}catch{return null}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,901,261,538],()=>r(8062));module.exports=s})();